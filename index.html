<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>  
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=visualization"></script>







<body>


<!-- PAGE MAP -->

<div data-role="page" id="page-map" class="page-map">

   <div id="espace-info-window" class="espace-info-window">
   
    

   </div>
  </div>


    <div id="map-canvas" class="map"></div> 
  <div id="bottom-button" class="bottom-button">
    <ul>
      <li><a href="#page-pin"><h1>Pin's</h1></li>
    </ul>
  </div>
</div>



<!-- PAGE PIN -->


<div data-role="page" id="page-pin" class="page-pin">
   <!-- <a href="#page-map" class="slide">Slide up to Page Two</a> -->

    <div class="titre"><h1>Selection</h1></div>
    <br>
    <br>
    <br>
    <br>
    <a href="#page-map"><p  style="color: black; text-align: center;">Revenir Ã  la page </p></a>

  <div class="list">
    
    <div id="test" class="data1"><img src="http://www.brandyapp.co/applifinal/design/3europin30.png"><br><h3>Bieres</h3></div>
    <div id="test" class="data2"><img src="http://www.brandyapp.co/applifinal/design/lebonbonpin30.png"><br><h3>Le bonbon</h3></div>
    <div id="test" class="data3"><img src="http://www.brandyapp.co/applifinal/design/rockpin30.png"><br><h3>Rock</h3></div>
    <div id="test" class="data4"><img src="http://www.brandyapp.co/applifinal/design/timeoutpin30.png"><br><h3>Timeout</h3></div>
    <div id="test" class="data5"><img src="http://www.brandyapp.co/applifinal/design/terrassepin30.png"><br><h3>Terrasses</h3></div>
    <div id="test" class="data1"><img src="http://www.brandyapp.co/applifinal/design/lgbtpin30.png"><br><h3>Gay</h3></div>
    <div id="test" class="data2"><img src="http://www.brandyapp.co/applifinal/design/electropin30.png"><br><h3>gay friendly</h3></div>
    <div id="test" class="data3"><img src="http://www.brandyapp.co/applifinal/design/tabacpin30.png"><br><h3>tabac</h3></div>
    <div id="test" class="data4"><img src="http://www.brandyapp.co/applifinal/design/3europin30.png"><br><h3>Bieres</h3></div>
    <div id="test" class="data5"><img src="http://www.brandyapp.co/applifinal/design/lgbtpin30.png"><br><h3>bieres</h3></div>
    <div id="test" class="data1"><img src="http://www.brandyapp.co/applifinal/design/allpin30.png"><br><h3>tous les events</h3></div>
    <div id="test" class="data4"><img src="http://www.brandyapp.co/applifinal/design/lebonbonpin30.png"><br><h3>le bonbon</h3></div>
    <div id="test" class="data1"><img src="http://www.brandyapp.co/applifinal/design/electropin30.png"><br><h3>Electro</h3></div>
    <div id="test" class="data1"><img src="http://www.brandyapp.co/applifinal/design/rockpin30.png"><br><h3>rock</h3></div>
    <div id="test" class="data1"><img src="http://www.brandyapp.co/applifinal/design/tabacpin30.png"><br><h3>tabac</h3></div>
    <div id="test" class="data5"><img src="http://www.brandyapp.co/applifinal/design/timeoutpin30.png"><br><h3>timeout</h3></div>  </div>

</div>




<script>

        $(function() {
        

        var map;
        var latlng = google.maps.LatLng(48.8,2.3);

// INITIALISATION GOOGLE MAP
 
        function initialize() {
          var mapOptions = {
            zoom: 14,
            center: latlng,
            streetViewControl: false,
            zoomControl: true,
            mapTypeControl: false,
            zoomControlOptions: {
                position: google.maps.ControlPosition.RIGHT_TOP
          }
        };
          map = new google.maps.Map(document.getElementById('map-canvas'),
              mapOptions);


// GEOLOCATION

          if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = new google.maps.LatLng(position.coords.latitude,
                                               position.coords.longitude);

              // marker de la position GPS de la personne
              var marker1 = new google.maps.Marker({
                map: map,
                position: pos,
                icon: 'http://www.brandyapp.co/applifinal/design/user.png'
              });

              map.setCenter(pos);
            }, function() {
              handleNoGeolocation(true);
            });
          } else {
            // Browser doesn't support Geolocation
            handleNoGeolocation(false);
          }

            // ENLEVE L'INFOWINDOW
          map.addListener('click', function() {
            var element = document.getElementById("info-window");
            element.parentNode.removeChild(element);
        });
        }

        function handleNoGeolocation(errorFlag) {
          if (errorFlag) {
            var content = 'Error: The Geolocation service failed.';
          } else {
            var content = 'Error: Your browser doesn\'t support geolocation.';
          }

          var options = {
            map: map,
            position: new google.maps.LatLng(48.87, 2.35),
            content: content
          };

          var infowindow = new google.maps.InfoWindow(options);
          map.setCenter(options.position);
        }
// CREATION DES TABLEAUX DE PINS

        var markers = [];

        // Sets the map on all markers in the array.z

        function setAllMap(map) {
          for (var i = 0; i < markers.length; i++) {
            if (i%2 == 0){
            markers[i].setMap(map);
            }
          }
          
        }
        // Removes the markers from the map, but keeps them in the array.
        
        function clearMarkers() {
          
          setAllMap(null);
          markers = [];
        }

        // Shows any markers currently in the array.
        
        function showMarkers() {
          setAllMap(map);
        }
     
        // Mise en place de L'infowindow
        
        function pushInfowindow (info) {   
          $('.espace-info-window').html(info);
        }

   // ALTERNANCE CERCLE SUR PINS

 
    $('#test img').click(function() {
      console.log($(this).css('border')==='2px solid rgb(23, 14, 38)');
      if ($(this).css('border')==='2px solid rgb(23, 14, 38)') {   
        $(this).css('border','2px solid #fff');
      } else {
        $(this).css('border','2px solid #170e26');
      }
    });

  


       
// AJAX REQUEST

          
          
          function generatePin (pins) { 
            $.ajax({
              url: pins+".json",
              async: false,
              dataType: 'json',
              type: "GET",
              success: function (json) {
                console.log(json)
                  $.each( json.data, function(i, response) {
                      console.log(response);
                      var myLatlng = new google.maps.LatLng(response.lat, response.lng);
                      var picture = response.picture;
                      var name = response.name;

                      // creation d'un marker
                      var marker = new google.maps.Marker({
                       position: myLatlng,
                       icon: 'http://www.brandyapp.co/applifinal/design/'+pins+'.png'                      
                      });

                      //construction du code HTML pour pins dans le cartouche
                      var pinCartouche = '';
                      for (i=0; i < response.pins.length; i++) {
                        pinCartouche = pinCartouche + '<object type="image/svg+xml" data="http://www.brandyapp.co/applifinal/design/' + response.pins[i] + 'pin30.svg" width="40px"></object>';
                      }
                      console.log(pinCartouche);
                      // creation de l'infowindow du marker
                      var infowindow = new google.maps.InfoWindow({
                          content:  '<div id="info-window" class="info-window"><img src="' + picture + '"><h4>' + name + '</h4><br>' + '<div class="pinCartouche">' +  pinCartouche + '</div></div>'
                      });
                      // Listener de l'infowindow
                      google.maps.event.addListener(marker, 'click', function() {
                        
                        var info = infowindow.getContent();
                        pushInfowindow (info); 
                      });
                      markers.push(marker);
                      markers.push(infowindow);
                  });
                }
                
              });
          };
        


// JQUERY AFFICHAGE DES PINS
          

        $(document).ready(function() {

            $('.data1').on('click', function(){
              clearMarkers();
              generatePin('bieres');
              showMarkers();
            }); 

            $('.data2').on('click', function(){
              clearMarkers();
              generatePin('lebonbon');
              showMarkers();
            }); 
            $('.data3').on('click', function(){
              clearMarkers();
              generatePin('rock');
              showMarkers();
            }); 
            $('.data4').on('click', function(){
              clearMarkers();
              generatePin('terrasse');
              showMarkers();
            }); 
            $('.data5').on('click', function(){
              clearMarkers();
              generatePin('lgbt');
              showMarkers();
            }); 

        });
        

        google.maps.event.addDomListener(window, 'load', initialize);
        });



    </script>
  

  

  </body>
</html>
