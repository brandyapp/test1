<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>  

    <script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCENn8lcf6FcqHLeugPNgZfsGlolhlENlw">
</script>






<body>


<!-- PAGE MAP -->

<div data-role="page" id="page-map" class="page-map">

   <div id="espace-info-window" class="espace-info-window">
   
    

   </div>
  </div>


    <div id="map-canvas" class="map"></div> 
  <div id="bottom-button" class="bottom-button">
    <ul>
      <li><a href="#page-pin"><h1>Pin's</h1></li>
    </ul>
  </div>
</div>



<!-- PAGE PIN -->


<div data-role="page" id="page-pin" class="page-pin" style="width:100%; height:100%;" >
   <!-- <a href="#page-map" class="slide">Slide up to Page Two</a> -->

    <div class="titre"><h1>Selection</h1></div>
    <br>
    <br>
 
    <a href="#page-map"><p  style="color: black; text-align: center;">Revenir à la page </p></a>

  <div class="list">
    
    <div id="test" class="lebonbon"><img src="http://www.brandyapp.co/applifinal/design/lebonbonpin.png"><br><h3>Le bonbon</h3></div>
    <div id="test" class="timeout"><img src="http://www.brandyapp.co/applifinal/design/timeoutpin.png"><br><h3>Timeout</h3></div>
    <div id="test" class="barclub"><img src="http://www.brandyapp.co/applifinal/design/barclubpin.png"><br><h3>bars clubs</h3></div>
    <div id="test" class="barabieres"><img src="http://www.brandyapp.co/applifinal/design/barabierespin.png"><br><h3>Bars à Bieres</h3></div>
    <div id="test" class="baravin"><img src="http://www.brandyapp.co/applifinal/design/baravinpin.png"><br><h3>Bars à vin</h3></div>
    <div id="test" class="barcache"><img src="http://www.brandyapp.co/applifinal/design/barcachepin.png"><br><h3>Bars cachés</h3></div>
    <div id="test" class="bar2h"><img src="http://www.brandyapp.co/applifinal/design/bar2hpin.png"><br><h3>Bars > 2h</h3></div>
    <div id="test" class="barcocktails"><img src="http://www.brandyapp.co/applifinal/design/barcocktailspin.png"><br><h3>Bars cocktails</h3></div>


  </div>

  <a href="#page-map"><p  style="color: black; text-align: center;">Revenir à la page </p></a>

</div>




<script>

        $(function() {
        

        var map;
        var latlng = google.maps.LatLng(48.8,2.3);

// INITIALISATION GOOGLE MAP
 
        function initialize() {
          var mapOptions = {
            zoom: 14,
            center: latlng,
            streetViewControl: false,
            zoomControl: true,
            mapTypeControl: false,
            zoomControlOptions: {
                position: google.maps.ControlPosition.RIGHT_TOP
          }
        };
          map = new google.maps.Map(document.getElementById('map-canvas'),
              mapOptions);


// GEOLOCATION

          if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = new google.maps.LatLng(position.coords.latitude,
                                               position.coords.longitude);

              // marker de la position GPS de la personne
              var marker1 = new google.maps.Marker({
                map: map,
                position: pos,
                icon: 'http://www.brandyapp.co/applifinal/design/user.png'
              });

              map.setCenter(pos);
            }, function() {
              handleNoGeolocation(true);
            });
          } else {
            // Browser doesn't support Geolocation
            handleNoGeolocation(false);
          }

            // ENLEVE L'INFOWINDOW
          map.addListener('click', function() {
            var element = document.getElementById("info-window");
            element.parentNode.removeChild(element);
        });
        }

        function handleNoGeolocation(errorFlag) {
          if (errorFlag) {
            var content = 'Error: The Geolocation service failed.';
          } else {
            var content = 'Error: Your browser doesn\'t support geolocation.';
          }

          var options = {
            map: map,
            position: new google.maps.LatLng(48.87, 2.35),
            content: content
          };

          var infowindow = new google.maps.InfoWindow(options);
          map.setCenter(options.position);
        }
// CREATION DES TABLEAUX DE PINS

        var markers = [];

        // Sets the map on all markers in the array.z

        function setAllMap(map) {
          for (var i = 0; i < markers.length; i++) {
            if (i%2 == 0){
            markers[i].setMap(map);
            }
          }
          
        }
        // Removes the markers from the map, but keeps them in the array.
        
        function clearMarkers() {
          
          setAllMap(null);
          markers = [];
        }

        // Shows any markers currently in the array.
        
        function showMarkers() {
          setAllMap(map);
        }
     
        // Mise en place de L'infowindow
        
        function pushInfowindow (info) {   
          $('.espace-info-window').html(info);
        }

   // ALTERNANCE CERCLE SUR PINS

 
    // $('#test img').click(function() {
    //   console.log($(this).css('border')==='2px solid rgb(23, 14, 38)');
    //   if ($(this).css('border')==='2px solid rgb(23, 14, 38)') {   
    //     $(this).css('border','2px solid #fff');
    //   } else {
    //     $(this).css('border','2px solid #170e26');
    //   }
    // });

  


       
// AJAX REQUEST

          
          
          function generatePin (pins) { 
            $.ajax({
              url: "json/"+pins+".json",
              async: false,
              dataType: 'json',
              type: "GET",
              success: function (json) {
                console.log(json)
                  $.each( json.data, function(i, response) {
                      console.log(response);
                      var myLatlng = new google.maps.LatLng(response.lat, response.lng);
                      console.log(myLatlng);
                      var picture = response.picture;
                      var name = response.name;

                      // creation d'un marker
                      var marker = new google.maps.Marker({
                       position: myLatlng,
                       icon: 'http://www.brandyapp.co/applifinal/design/'+pins+'marker.png',
                                         
                      });

                      //construction du code HTML pour pins dans le cartouche
                      var pinCartouche = '';
                      for (i=0; i < response.pins.length; i++) {
                        pinCartouche = pinCartouche + '<object type="image/svg+xml" data="http://www.brandyapp.co/applifinal/design/' + response.pins[i] + 'pin.svg" width="40px"></object>';
                      }
                      console.log(pinCartouche);
                      // creation de l'infowindow du marker
                      var infowindow = new google.maps.InfoWindow({
                          content:  '<div id="info-window" class="info-window"><img src="' + picture + '"><h4>' + name + '</h4><br>' + '<div class="pinCartouche">' +  pinCartouche + '</div></div>'
                      });
                      // Listener de l'infowindow
                      google.maps.event.addListener(marker, 'click', function() {
                        
                        var info = infowindow.getContent();
                        pushInfowindow (info); 
                      });
                      markers.push(marker);
                      markers.push(infowindow);
                  });
                }
                
              });
          };
        


// JQUERY AFFICHAGE DES PINS

        $(document).ready(function() {

            $('.lebonbon').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }
              clearMarkers();
              console.log(" clearmarker done");
              generatePin('lebonbon');
              showMarkers();
            }); 

            $('.timeout').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }
              clearMarkers();
              generatePin('timeout');
              showMarkers();
            }); 
            $('.barclub').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }
              clearMarkers();
              generatePin('barclub');
              showMarkers();
            }); 
            $('.barabieres').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }

              clearMarkers();
              generatePin('barabieres');
              showMarkers();
            }); 
            $('.baravin').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }
              clearMarkers();
              generatePin('baravin');
              showMarkers();
            }); 
            $('.barcache').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }
              clearMarkers();
              generatePin('barcache');
              showMarkers();
            }); 
            $('.bar2h').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }
              clearMarkers();
              generatePin('bar2h');
              showMarkers();
            }); 
            $('.barcocktails').on('click', function(){
              if ($(this).children('img').css('border')==='2px solid rgb(23, 14, 38)') {   
                $(this).children('img').css('border','2px solid #fff');
              } else {
                $(this).children('img').css('border','2px solid #170e26');
              }
              clearMarkers();
              generatePin('barcocktails');
              showMarkers();
            }); 
        });
        

        google.maps.event.addDomListener(window, 'load', initialize);
        });



    </script>
  

  

  </body>
</html>
