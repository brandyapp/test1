<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>  
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=visualization"></script>







<body>


<!-- PAGE MAP -->

<div data-role="page" id="page-map" class="page-map">

  
   <div id="info-window" class='info-window'>Infowindow test</div>


    <div id="map-canvas" class="map"></div> 
  <div id="bottom-button" class="bottom-button">
    <ul>
      <li><a href="#page-pin"><h1>Evènements</h1></li>
      <li><a href="#page-pin"><h1>Pin's</h1></li>
    </ul>
  </div>
</div>



<!-- PAGE PIN -->


<div data-role="page" id="page-pin" class="page-pin">
   <!-- <a href="#page-map" class="slide">Slide up to Page Two</a> -->

    <div class="titre"><h1>Votre sélection..</h1></div>


  <div class="list">
    <div id="test" class="data1"><img src="design/3europin30.png"><br><h3>Bieres</h3></div>
    <div id="test" class="data1"><img src="design/5europin30.png"><br><h3>bieres</h3></div>
    <div -+id="test" class="data1"><img src="design/alleventspin30.png"><br><h3>tous les events</h3></div>
    <div id="test" class="data1"><img src="design/bonbonpin30.png"><br><h3>le bonbon</h3></div>
    <div id="test" class="data1"><img src="design/lgbtpin30.png"><br><h3>gay friendly</h3></div>
    <div id="test" class="data1"><img src="design/rockpin30.png"><br><h3>rock</h3></div>
    <div id="test" class="data1"><img src="design/tabacpin30.png"><br><h3>tabac</h3></div>
    <div id="test" class="data1"><img src="design/timeoutpin30.png"><br><h3>timeout</h3></div>
    <div id="test" class="data1"><img src="design/3europin30.png"><br><h3></h3></div>
    <div id="test" class="data1"><img src="design/5europin30.png"><br><h3></h3></div>
    <div id="test" class="data1"><img src="design/alleventspin30.png"><br><h3></h3></div>
    <div id="test" class="data1"><img src="design/bonbonpin30.png"><br><h3></h3></div>
    <div id="test" class="data1"><img src="design/lgbtpin30.png"><br><h3></h3></div>
    <div id="test" class="data1"><img src="design/rockpin30.png"><br><h3></h3></div>
    <div id="test" class="data1"><img src="design/tabacpin30.png"><br><h3></h3></div>
    <div id="test" class="data1"><img src="design/timeoutpin30.png"><br><h3></h3></div>
    
    <div id="test" class="data2">affiche data2</div>
    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>
        <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>
        <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>    <div id="test" class="data1">affiche data1</div>
    <div id="test" class="data2">affiche data2</div>
  </div>

  <div id="bottom-button" class="bottom-button">
    <ul>
      <li><a href="#page-pin" data-transition="none"><h1>Evènements</h1></li>
      <li><a href="#page-pin"><h1>Pin's</h1></li>
    </ul>
  </div>

</div>




<script>

        $(function() {
        

        var map;
        var latlng = google.maps.LatLng(48.8,2.3);

// INITIALISATION GOOGLE MAP
 
        function initialize() {
          var mapOptions = {
            zoom: 12,
            center: latlng
          };
          map = new google.maps.Map(document.getElementById('map-canvas'),
              mapOptions);


// GEOLOCATION

          if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = new google.maps.LatLng(position.coords.latitude,
                                               position.coords.longitude);

              // marker de la position GPS de la personne
              var marker1 = new google.maps.Marker({
                map: map,
                position: pos,
                icon: 'design/lgbt.png'
              });

              map.setCenter(pos);
            }, function() {
              handleNoGeolocation(true);
            });
          } else {
            // Browser doesn't support Geolocation
            handleNoGeolocation(false);
          }

        }

        function handleNoGeolocation(errorFlag) {
          if (errorFlag) {
            var content = 'Error: The Geolocation service failed.';
          } else {
            var content = 'Error: Your browser doesn\'t support geolocation.';
          }

          var options = {
            map: map,
            position: new google.maps.LatLng(48.87, 2.35),
            content: content
          };

          var infowindow = new google.maps.InfoWindow(options);
          map.setCenter(options.position);
        }
// CREATION DES TABLEAUX DE PINS

        var markers = [];

        // Sets the map on all markers in the array.z

        function setAllMap(map) {
          for (var i = 0; i < markers.length; i++) {
            if (i%2 == 0){
            markers[i].setMap(map);
            }
          }
          
        }
        // Removes the markers from the map, but keeps them in the array.
        
        function clearMarkers() {
          
          setAllMap(null);
          markers = [];
        }

        // Shows any markers currently in the array.
        
        function showMarkers() {
          setAllMap(map);
        }
     
        // Mise en place de L'infowindow
        
        function pushInfowindow (info) {   
          $('.info-window').text(info);
        }

        
// AJAX REQUEST

          
          
          function generatePin (pin) { 
            $.ajax({
              url: pin+".json",
              async: false,
              dataType: 'json',
              type: "GET",
              success: function (json) {
                  $.each( json.data, function(i, response) {
                      
                      var myLatlng = new google.maps.LatLng(response.lat, response.lng);
                      var title = response.title;
                      // creation d'un marker
                      var marker = new google.maps.Marker({
                       position: myLatlng,
                       icon: 'design/lgbt.png',
                       
                      });
                      // creation de l'infowindow du marker
                      var infowindow = new google.maps.InfoWindow({
                          content: title
                      });
                      // Listener de l'infowindow
                      google.maps.event.addListener(marker, 'click', function() {
                        console.log(infowindow.getContent());
                        var info = infowindow.getContent();
                        pushInfowindow (info); 
                      });
                      markers.push(marker);
                      markers.push(infowindow);
                  });
                }
                
              });
          };
        
            
// JQUERY AFFICHAGE DES PINS
          

        $(document).ready(function() {

            $('.data1').on('click', function(){
              clearMarkers();
              generatePin('data1');
              showMarkers();
            }); 

             $('.data2').click(function(){
              clearMarkers();
              generatePin('data2');
              showMarkers();           
            });

        });
        

        google.maps.event.addDomListener(window, 'load', initialize);
        });

// ALTERNANCE CERCLE SUR PINS

 
    $('#test img').click(function() {
      if ($(this).css('border')==='2px solid rgb(23, 14, 38)') {   
        $(this).css('border','2px solid #fff');
      } else {
        $(this).css('border','2px solid #170e26');
      }
    });

     $('#test img').click(function() {
      console.log($('#test h3').css('border'));
      //console.log($('#test h3').css('border')==='2px solid rgb(23, 14, 38)');
      if ($('#test h3').css('border')==='2px solid rgb(23, 14, 38)') {   
        $('#test h3').css('border','2px solid #fff');
      } else {
        $('#test h3').css('border','2px solid #170e26');
      }
    });

    </script>
  

  

  </body>
</html>
